.side-bar
  .navbar
    .navbar-inner
      %button(class="btn mobile-item-button visible-phone invisible" id="mobileBackButton" title="#{t.buttons.back}")
        %i(class="icon-arrow-left")
      .btn-group
        %button(class="btn btn-inverse hidden-tiny-phone")
          %i(id="spinner" class="icon-spinner icon-large invisible")
        %button(class="btn" id="syncButton" title="#{t.buttons.sync}")
          %i(class="icon-refresh")
        %button(class="btn hidden-phone" id="toggleReadVisibilityButton" title="#{t.buttons.toggle_read}")
          %i(class="icon-eye-open")
        %button(class="btn" href="#subscriptionModal" role="button" data-toggle="modal" title="#{t.buttons.subscribe}")
          %i(class="icon-plus")
        %button(class="btn hidden-tiny-phone" href="#settingsModal" role="button" data-toggle="modal" title="#{t.buttons.settings}")
          %i(class="icon-cog")
      .btn-group
        %button(class="btn mobile-item-button visible-phone invisible" id="mobileNextItem" title="#{t.buttons.previous}")
          %i(class="icon-circle-arrow-left")
        %button(class="btn mobile-item-button visible-phone invisible" id="mobilePrevItem" title="#{t.buttons.next}")
          %i(class="icon-circle-arrow-right")
  .dragbar.hidden-phone
  .feed-list
    %ul(id="feed-list" class="nav nav-list")
.content
  #item-list.hidden-phone

-# Subscription form

%div(class="modal hide fade" id="subscriptionModal" tabindex="-1" role="dialog" aria-labelledby="subscriptionModal" aria-hidden="true")
  .modal-header
    =t.subscribe.subscribe
    %button(type="button" class="close" data-dismiss="modal" aria-hidden="true")
      x
  .modal-body
    %label
      =t.subscribe.url
    %input(class="input-block-level" type="text" id="subscriptionUrl" aria-hidden="true")
    %label
      =t.subscribe.folder
    %input(class="input-block-level" type="text" id="subscriptionFolder" aria-hidden="true")
  .modal-footer
    %button(type="button" id="subscribeButton" data-dismiss="modal" class="btn btn-primary" aria-hidden="true")
      =t.subscribe.subscribe

-# Edit feed form

%div(class="modal hide fade" id="editFeedModal" tabindex="-1" role="dialog" aria-labelledby="editFeedModal" aria-hidden="true")
  .modal-header
    =t.edit_feed.title
    %button(type="button" class="close" data-dismiss="modal" aria-hidden="true")
      x
  .modal-body
    %label
      =t.edit_feed.url
    %input(class="input-block-level" type="text" id="feedUrl" aria-hidden="true")
    %label
      =t.edit_feed.folder
    %input(class="input-block-level" type="text" id="feedFolder" aria-hidden="true")
    %label.checkbox
      %input(type="checkbox" id="resetFeed" checked="checked")
      =t.edit_feed.reset
    %input(type="hidden" id="feedId" value="")
  .modal-footer
    %button(type="button" id="editFeedButton" data-dismiss="modal" class="btn btn-primary" aria-hidden="true")
      =t.edit_feed.save

-# Edit folder form

%div(class="modal hide fade" id="editFolderModal" tabindex="-1" role="dialog" aria-labelledby="editFolderModal" aria-hidden="true")
  .modal-header
    =t.edit_folder.title
    %button(type="button" class="close" data-dismiss="modal" aria-hidden="true")
      x
  .modal-body
    %label
      =t.edit_folder.title_label
    %input(class="input-block-level" type="text" id="folderTitle" aria-hidden="true")
    %input(type="hidden" id="folderId" value="")
  .modal-footer
    %button(type="button" id="editFolderButton" data-dismiss="modal" class="btn btn-primary" aria-hidden="true")
      =t.edit_folder.save

-# Settings form

%form(class="settings-form form-horizontal" method="post" enctype="multipart/form-data" action="/save_settings")
  %div(class="modal hide fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModal" aria-hidden="true")
    .modal-header
      =t.settings.title
      %button(type="button" class="close" data-dismiss="modal" aria-hidden="true")
        x
    .modal-body
      %ul.nav.nav-tabs
        %li.active
          %a(href="#accountSettings" data-toggle="tab")
            =t.settings.account
        %li
          %a(href="#opmlSettings" data-toggle="tab")
            =t.settings.opml
        %li
          %a(href="#cleanupSettings" data-toggle="tab")
            =t.settings.cleanup
        %li
          %a(href="#syncSettings" data-toggle="tab")
            =t.settings.sync
      .tab-content
        .tab-pane.active#accountSettings
          .well
            .control-group
              %label.control-label
                =t.settings.username
              .controls
                %input(class="input-block-level" type="text" name="username" value="#{settings.username}" aria-hidden="true")
            .control-group
              %label.control-label
                =t.settings.current_password
              .controls
                %input(class="input-block-level" type="password" name="old_password" aria-hidden="true")
            .control-group
              %label.control-label
                =t.settings.new_password
              .controls
                %input(class="input-block-level" type="password" name="new_password" aria-hidden="true")
          .control-group
            %label.control-label
              =t.settings.language
            .controls
              %select(name="default_locale")
                - r18n.available_locales.each do |locale|
                  %option(value="#{locale.code}"){selected: r18n.locale.code == locale.code}
                    =locale.title
        .tab-pane#opmlSettings
          %button(class="btn" href="#opmlModal" role="button" data-dismiss="modal" data-toggle="modal")
            =t.settings.import_opml_file
          %a(class="btn" href="/export.opml")
            =t.settings.export_as_opml
        .tab-pane#cleanupSettings
          %label
            =t.settings.cleanup_older_than
          .input-append
            %input(class="input-block-level" type="text" id="cleanup_after" name="cleanup_after" value="#{settings.cleanup_after}" aria-hidden="true")
            %span.add-on
              =t.settings.days
          %button(class="btn pull-right" id="cleanupButton" data-dismiss="modal")
            =t.settings.cleanup
        .tab-pane#syncSettings
          .control-group
            %label.control-label
              =t.settings.refresh_every
            .controls
              .input-append
                %input(class="input-block-level" type="text" name="refresh_timeout" value="#{settings.refresh_timeout}" aria-hidden="true")
                %span.add-on
                  =t.settings.minutes
          .control-group
            %label.control-label
              =t.settings.sync_every
            .controls
              .input-append
                %input(class="input-block-level" type="text" name="sync_timeout" value="#{settings.sync_timeout}" aria-hidden="true")
                %span.add-on
                  =t.settings.minutes
    .modal-footer
      %button(type="submit" class="btn btn-primary" aria-hidden="true")
        =t.settings.save

-# OPML Upload Modal Dialog

%form(class="upload-form" method="post" enctype="multipart/form-data" action="/opml_upload")
  %div(class="modal hide fade" id="opmlModal" tabindex="-1" role="dialog" aria-labelledby="opmlModal" aria-hidden="true")
    .modal-header
      =t.opml_import.title
      %button(type="button" class="close" data-dismiss="modal" aria-hidden="true")
        x
    .modal-body
      %input(type="file" name="file" aria-hidden="true")
    .modal-footer
      %button(type="submit" class="btn btn-primary" aria-hidden="true")
        =t.opml_import.upload


-# Underscore Templates

:plain
  <script id='tmpl-folder' type='text/template'>
    <div class="folderTitle<% if(folder.active){ %> active <% } %>">
      <i class="folder-icon <% if(folder.open){ %>icon-folder-open<% }else{ %>icon-folder-close<% } %>"></i>
      <% if(folder.unread_count > 0) { %>
        <b><%= folder.title %></b>
        <span class="badge badge-info"><%= folder.unread_count %></span>
      <% }else{ %>
        <%= folder.title %>
      <% } %>
      <i class="icon icon-caret-down menu-toggle"></i>
    </div>
    <div class="btn-group folderMenu hide">
      <a class="btn markFolderReadAction" title="#{t.buttons.mark_all_read}"><i class="icon-eye-open"></i></a>
      <a class="btn markFolderUnreadAction" title="#{t.buttons.mark_all_unread}"><i class="icon-eye-close"></i></a>
      <a class="btn syncFolderAction" title="#{t.buttons.sync}"><i class="icon-refresh"></i></a>
      <a class="btn editFolderAction" title="#{t.buttons.edit}"><i class="icon-edit"></i></a>
      <a class="btn deleteFolderAction" title="#{t.buttons.delete}"><i class="icon-trash"></i></a>
    </div>
  </script>

  <script id='tmpl-feed' type='text/template'>
    <div class="feedTitle<% if(feed.active){ %> active<% } %>">
      <i class="icon icon-caret-down menu-toggle"></i>
      <% if(feed.unread_count > 0) { %>
        <b><%= feed.title %></b>
        <span class="badge badge-info"><%= feed.unread_count %></span>
      <% }else{ %>
        <%= feed.title %>
      <% } %>
    </div>
    <div class="btn-group feedMenu hide">
      <a class="btn markFeedReadAction" title="#{t.buttons.mark_all_read}"><i class="icon-eye-open"></i></a>
      <a class="btn markFeedUnreadAction" title="#{t.buttons.mark_all_unread}"><i class="icon-eye-close"></i></a>
      <a class="btn syncFeedAction" title="#{t.buttons.sync}"><i class="icon-refresh"></i></a>
      <a class="btn editFeedAction" title="#{t.buttons.edit}"><i class="icon-edit"></i></a>
      <a class="btn deleteFeedAction" title="#{t.buttons.delete}"><i class="icon-trash"></i></a>
    </div>
  </script>

  <script id='tmpl-item' type='text/template'>
    <div class="item-container<% if(item.open){ %> active<% } %>">
      <div class="item-icons">
        <span class="dropdown">
          <i class="icon icon-caret-down dropdown-toggle" data-toggle="dropdown"></i>
          <ul class="dropdown-menu" role="menu" aria-labelledby="item-<%= item.id %>-menu">
            <li><a class="readOlderAction">#{t.buttons.mark_older_read}</a></li>
          </ul>
        </span>
        <i class="readUnreadIcon icon-circle<% if(item.read){ %>-blank<% } %>"></i>
      </div>

      <div class="item-date hidden-phone">
        <span class="label">
          <%= formatDate(new Date(item.date)) %>
        </span>
      </div>

      <div class="item-title">
        <% if(!item.read){ %>
          <b><%= item.title %></b>
        <% }else{ %>
          <%= item.title %>
        <% } %>
      </div>
    </div>

    <% if(item.open){ %>
      <div class="well item-content">
        <a class="item-content-title" href="<%= item.url %>" target="_blank"><%= item.title %></a>
        <br>
        <%= item.content %>
        <% if(item.attachment_url){ %>
          <br>
          <a class="btn" href="<%= item.attachment_url %>">
            <i class="icon-download"></i>Download file
          </a>
        <% } %>
      </div>
    <% } %>
  </script>

-# Javascript settings

:javascript
  var SETTINGS = {
    refresh_timeout: #{settings.refresh_timeout},
    sync_timeout: #{settings.sync_timeout},
    show_read: true
  };
